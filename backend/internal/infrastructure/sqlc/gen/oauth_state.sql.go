// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: oauth_state.sql

package gen

import (
	"context"
)

const cleanupExpiredOAuthStates = `-- name: CleanupExpiredOAuthStates :exec
DELETE FROM oauth_states
WHERE created_at < NOW() - INTERVAL '10 minutes'
`

func (q *Queries) CleanupExpiredOAuthStates(ctx context.Context) error {
	_, err := q.db.Exec(ctx, cleanupExpiredOAuthStates)
	return err
}

const consumeOAuthState = `-- name: ConsumeOAuthState :exec
UPDATE oauth_states
SET consumed_at = NOW()
WHERE state = $1
`

func (q *Queries) ConsumeOAuthState(ctx context.Context, state string) error {
	_, err := q.db.Exec(ctx, consumeOAuthState, state)
	return err
}

const getOAuthState = `-- name: GetOAuthState :one
SELECT os.state, os.code_verifier, os.nonce, os.created_at, os.consumed_at
FROM oauth_states os
WHERE os.state = $1
AND os.consumed_at IS NULL
`

type GetOAuthStateRow struct {
	OauthState OauthState
}

func (q *Queries) GetOAuthState(ctx context.Context, state string) (GetOAuthStateRow, error) {
	row := q.db.QueryRow(ctx, getOAuthState, state)
	var i GetOAuthStateRow
	err := row.Scan(
		&i.OauthState.State,
		&i.OauthState.CodeVerifier,
		&i.OauthState.Nonce,
		&i.OauthState.CreatedAt,
		&i.OauthState.ConsumedAt,
	)
	return i, err
}

const saveOAuthState = `-- name: SaveOAuthState :exec
INSERT INTO oauth_states (
    state,
    code_verifier,
    nonce,
    created_at
) VALUES (
    $1, $2, $3, NOW()
)
`

type SaveOAuthStateParams struct {
	State        string
	CodeVerifier string
	Nonce        string
}

func (q *Queries) SaveOAuthState(ctx context.Context, arg SaveOAuthStateParams) error {
	_, err := q.db.Exec(ctx, saveOAuthState, arg.State, arg.CodeVerifier, arg.Nonce)
	return err
}
