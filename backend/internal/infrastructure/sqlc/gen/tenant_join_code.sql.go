// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: tenant_join_code.sql

package gen

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const createTenantJoinCode = `-- name: CreateTenantJoinCode :one
INSERT INTO tenant_join_codes(
    id,
    tenant_id,
    code,
    expires_at,
    max_uses,
    used_count
)
VALUES(
    $1,
    $2,
    $3,
    $4,
    $5,
    $6
)
RETURNING tenant_join_codes.id, tenant_join_codes.tenant_id, tenant_join_codes.code, tenant_join_codes.expires_at, tenant_join_codes.max_uses, tenant_join_codes.used_count, tenant_join_codes.created_at
`

type CreateTenantJoinCodeParams struct {
	ID        uuid.UUID
	TenantID  uuid.UUID
	Code      string
	ExpiresAt pgtype.Timestamptz
	MaxUses   int32
	UsedCount int32
}

type CreateTenantJoinCodeRow struct {
	TenantJoinCode TenantJoinCode
}

func (q *Queries) CreateTenantJoinCode(ctx context.Context, arg CreateTenantJoinCodeParams) (CreateTenantJoinCodeRow, error) {
	row := q.db.QueryRow(ctx, createTenantJoinCode,
		arg.ID,
		arg.TenantID,
		arg.Code,
		arg.ExpiresAt,
		arg.MaxUses,
		arg.UsedCount,
	)
	var i CreateTenantJoinCodeRow
	err := row.Scan(
		&i.TenantJoinCode.ID,
		&i.TenantJoinCode.TenantID,
		&i.TenantJoinCode.Code,
		&i.TenantJoinCode.ExpiresAt,
		&i.TenantJoinCode.MaxUses,
		&i.TenantJoinCode.UsedCount,
		&i.TenantJoinCode.CreatedAt,
	)
	return i, err
}

const getTenantByJoinCode = `-- name: GetTenantByJoinCode :one
SELECT
    t.id, t.organization_id, t.name, t.description, t.tenant_type, t.created_at, t.updated_at
FROM tenant_join_codes tjc
INNER JOIN tenants t ON tjc.tenant_id = t.id
WHERE tjc.code = $1
    AND (tjc.expires_at IS NULL OR tjc.expires_at > CURRENT_TIMESTAMP)
    AND (tjc.max_uses = 0 OR tjc.used_count < tjc.max_uses)
`

type GetTenantByJoinCodeRow struct {
	Tenant Tenant
}

func (q *Queries) GetTenantByJoinCode(ctx context.Context, code string) (GetTenantByJoinCodeRow, error) {
	row := q.db.QueryRow(ctx, getTenantByJoinCode, code)
	var i GetTenantByJoinCodeRow
	err := row.Scan(
		&i.Tenant.ID,
		&i.Tenant.OrganizationID,
		&i.Tenant.Name,
		&i.Tenant.Description,
		&i.Tenant.TenantType,
		&i.Tenant.CreatedAt,
		&i.Tenant.UpdatedAt,
	)
	return i, err
}

const updateTenantJoinCodeByTenantId = `-- name: UpdateTenantJoinCodeByTenantId :exec
UPDATE tenant_join_codes
SET 
    code = $1,
    expires_at = $2,
    max_uses = $3
WHERE tenant_id = $4
`

type UpdateTenantJoinCodeByTenantIdParams struct {
	Code      string
	ExpiresAt pgtype.Timestamptz
	MaxUses   int32
	TenantID  uuid.UUID
}

func (q *Queries) UpdateTenantJoinCodeByTenantId(ctx context.Context, arg UpdateTenantJoinCodeByTenantIdParams) error {
	_, err := q.db.Exec(ctx, updateTenantJoinCodeByTenantId,
		arg.Code,
		arg.ExpiresAt,
		arg.MaxUses,
		arg.TenantID,
	)
	return err
}
